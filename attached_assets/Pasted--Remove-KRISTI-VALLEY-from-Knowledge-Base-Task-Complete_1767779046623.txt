# Remove KRISTI VALLEY from Knowledge Base

## Task
Completely remove all KRISTI VALLEY references from the knowledge base and vector database so Maya never mentions it.

---

## Step 1: Search for KRISTI VALLEY in Knowledge Base

Find all files mentioning KRISTI VALLEY:
```bash
# Search all knowledge base files
grep -ri "kristi valley\|kristal valley\|–∫—Ä—ñ—Å—Ç—ñ\|–∫—Ä—ñ—Å—Ç–∞–ª" backend/knowledge_base/
grep -ri "kristi valley\|kristal valley" backend/data/

# Also check scraped content
grep -ri "kristi valley\|kristal valley" backend/scrapers/
```

Delete or remove sections mentioning KRISTI VALLEY from found files.

---

## Step 2: Remove from Pinecone Vector Database

**Update the existing cleanup script:**

**Modify: `backend/scripts/remove_discontinued_products.py`**

Add KRISTI VALLEY to the removal list:
```python
import os
from pinecone import Pinecone
from openai import OpenAI

pc = Pinecone(api_key=os.getenv('PINECONE_API_KEY'))
index = pc.Index(os.getenv('PINECONE_INDEX_NAME'))
openai_client = OpenAI(api_key=os.getenv('OPENAI_API_KEY'))

def get_embedding(text):
    response = openai_client.embeddings.create(
        model="text-embedding-3-small",
        input=text
    )
    return response.data[0].embedding

# Products to remove
products_to_remove = [
    # Previously discontinued
    'marlin vodka', '–º–∞—Ä–ª—ñ–Ω –≥–æ—Ä—ñ–ª–∫–∞',
    'adjari cognac', '–∞–¥–∂–∞—Ä—ñ –∫–æ–Ω—å—è–∫',
    
    # Add KRISTI VALLEY
    'kristi valley', 'kristal valley', '–∫—Ä—ñ—Å—Ç—ñ –≤–µ–ª–ª—ñ', '–∫—Ä—ñ—Å—Ç–∞–ª –≤–µ–ª–ª—ñ',
    'kristi valley wine', 'kristi valley –≤–∏–Ω–æ'
]

print("üîç Removing discontinued products from vector DB...")

for product in products_to_remove:
    query_embedding = get_embedding(product)
    
    results = index.query(
        vector=query_embedding,
        top_k=50,
        include_metadata=True
    )
    
    ids_to_delete = []
    for match in results.matches:
        metadata_text = str(match.metadata).lower()
        # Check for KRISTI/KRISTAL variations
        if any(word in metadata_text for word in ['kristi', 'kristal', '–∫—Ä—ñ—Å—Ç—ñ', '–∫—Ä—ñ—Å—Ç–∞–ª', 'marlin', 'marl√≠n', 'adjari']):
            ids_to_delete.append(match.id)
            print(f"  üìå Found: {match.id} (score: {match.score:.3f})")
    
    if ids_to_delete:
        index.delete(ids=ids_to_delete)
        print(f"‚úÖ Deleted {len(ids_to_delete)} entries for: {product}")
    else:
        print(f"‚ÑπÔ∏è No entries found for: {product}")

print("üéâ Cleanup complete!")
```

**Run the script:**
```bash
python backend/scripts/remove_discontinued_products.py
```

---

## Step 3: Update Portfolio Documentation

**If KRISTI VALLEY is mentioned in any portfolio lists, remove it.**

Check files like:
- System prompts
- /help message
- Best Brands product lists
- Any marketing materials

**Updated Best Brands Portfolio (without KRISTI VALLEY):**
```markdown
## Best Brands Active Portfolio (January 2026)

**–ì–æ—Ä—ñ–ª–∫–∞ (Vodka):**
- GREENDAY - —É–∫—Ä–∞—ó–Ω—Å—å–∫–∏–π –ø—Ä–µ–º—ñ—É–º
- HELSINKI - —Ñ—ñ–Ω—Å—å–∫–∏–π –±—Ä–µ–Ω–¥
- UKRAINKA - —É–∫—Ä–∞—ó–Ω—Å—å–∫–∏–π –∫–ª–∞—Å–∏—á–Ω–∏–π

**–ö–æ–Ω—å—è–∫/Spirits:**
- DOVBUSH (–î–æ–≤–±—É—à –ö–∞—Ä–ø–∞—Ç—Å—å–∫–∏–π) - —É–∫—Ä–∞—ó–Ω—Å—å–∫–∏–π –∫–æ–Ω—å—è–∫

**–í–∏–Ω–æ (Wine):**
- VILLA UA - —É–∫—Ä–∞—ó–Ω—Å—å–∫—ñ —ñ–≥—Ä–∏—Å—Ç—ñ –≤–∏–Ω–∞
- ADJARI - –≥—Ä—É–∑–∏–Ω—Å—å–∫—ñ –≤–∏–Ω–∞

**–°–æ–¥–∂—É (Soju):**
- FUNJU - –ø–µ—Ä—à–µ —É–∫—Ä–∞—ó–Ω—Å—å–∫–µ —Å–æ–¥–∂—É –∑–∞ –∫–æ—Ä–µ–π—Å—å–∫–∏–º —Ä–µ—Ü–µ–ø—Ç–æ–º
```

---

## Step 4: Verification

After removal, test that KRISTI VALLEY is gone:
```bash
# Check knowledge base
grep -ri "kristi\|kristal" backend/knowledge_base/

# Should return nothing or very few results
```

**Test queries:**
```
User: –†–æ–∑–∫–∞–∂–∏ –ø—Ä–æ KRISTI VALLEY
Expected: "–ù–∞ –∂–∞–ª—å, —É –º–µ–Ω–µ –Ω–µ–º–∞—î —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ —Ü–µ–π –ø—Ä–æ–¥—É–∫—Ç"

User: –Ø–∫—ñ –≤–∏–Ω–∞ —î —É Best Brands?
Expected: Lists only VILLA UA and ADJARI (no KRISTI VALLEY)

User: –©–æ —Ç–∞–∫–µ Funju?
Expected: "FUNJU ‚Äî –ø–µ—Ä—à–µ —É–∫—Ä–∞—ó–Ω—Å—å–∫–µ —Å–æ–¥–∂—É, –≤–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–µ –∑–∞ –∫–æ—Ä–µ–π—Å—å–∫–∏–º —Ä–µ—Ü–µ–ø—Ç–æ–º"
```

---

## Files to Modify

1. **MODIFY:** `backend/scripts/remove_discontinued_products.py` (add KRISTI VALLEY to removal list)
2. **SEARCH & DELETE:** Any knowledge base files mentioning KRISTI VALLEY
3. **RUN:** Cleanup script to remove from Pinecone
4. **VERIFY:** Portfolio lists don't mention it
5. **UPDATE:** Correct FUNJU description (soju, not cocktails)

---

## Expected Result

**After removal:**
- ‚úÖ No KRISTI VALLEY in vector database
- ‚úÖ No KRISTI VALLEY in knowledge base files  
- ‚úÖ Maya doesn't mention it when asked about portfolio
- ‚úÖ No hallucinations about "Armenian cognac"
- ‚úÖ FUNJU correctly described as Ukrainian soju (not cocktails)

**Best Brands complete portfolio:**
- **Vodka:** GREENDAY, HELSINKI, UKRAINKA
- **Cognac/Spirits:** DOVBUSH
- **Wine:** VILLA UA, ADJARI
- **Soju:** FUNJU (–ø–µ—Ä—à–µ —É–∫—Ä–∞—ó–Ω—Å—å–∫–µ —Å–æ–¥–∂—É –∑–∞ –∫–æ—Ä–µ–π—Å—å–∫–∏–º —Ä–µ—Ü–µ–ø—Ç–æ–º)

Simple and accurate!