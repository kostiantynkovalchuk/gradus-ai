We need to migrate ALL data from the old Replit-managed Neon database 
to a new independent Neon database. The new database is already connected 
and SQLAlchemy has auto-created empty tables.

This system runs TWO separate products:
1. GradusMedia Content Factory (scraping, translation, Facebook/LinkedIn posting)
2. Maya HR Bot (Telegram HR assistant for 800 AVTD employees)

DO NOT make any changes yet. Follow this exact sequence:

═══════════════════════════════════════
PHASE 1: VERIFY NEW SCHEMA FIRST
═══════════════════════════════════════

Run this against the NEW database to confirm all tables exist 
and capture exact column structure:

SELECT table_name, column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_schema = 'public'
ORDER BY table_name, ordinal_position;

Report the full output before proceeding.

═══════════════════════════════════════
PHASE 2: EXPORT ALL DATA FROM OLD DATABASE
═══════════════════════════════════════

Connect to the OLD database (NEON_DATABASE_URL secret) and export 
every table as SQL INSERT statements. Export in this exact order 
to respect foreign key dependencies:

CRITICAL - export these first (auth/access system):
1. hr_whitelist        (admin access - if empty Maya bot is locked)
2. hr_users            (verified employees - losing this forces 800 people to re-verify)

HR Bot tables:
3. hr_content          (43 rows - knowledge base)
4. hr_preset_answers   (31 rows - instant responses)
5. hr_menu_structure   (Telegram menu config)
6. hr_embeddings       (39 rows - Pinecone sync references)
7. hr_query_log        (22 rows - analytics)
8. hr_feedback         (7 rows - satisfaction data)
9. hr_documents        (7 rows)
10. hr_daily_stats
11. verification_log   (if exists)
12. maya_query_log     (if exists)

GradusMedia Content Factory tables:
13. content_queue      (330 rows - articles pipeline)
14. approval_log       (420 rows - posting history)
15. scrape_log         (if exists - last scrape timestamps)
16. apscheduler_jobs   (0 rows - skip if empty)

For each table, output:
- Row count before export
- Complete INSERT statements with all columns explicit
- Confirmation of export completion

═══════════════════════════════════════
PHASE 3: VERIFY EXPORT COMPLETENESS
═══════════════════════════════════════

Before importing anything, confirm:
- Total rows exported matches total rows in old database
- No tables were skipped
- All INSERT statements are valid SQL
- content_queue image_data BYTEA column is included

═══════════════════════════════════════
PHASE 4: IMPORT TO NEW DATABASE
═══════════════════════════════════════

Import in the same dependency order as export.
For each table:
- Run INSERT statements with ON CONFLICT DO NOTHING as safety net
- Verify row count matches after import
- Report any errors immediately, do not continue if errors occur

═══════════════════════════════════════
PHASE 5: POST-MIGRATION VERIFICATION
═══════════════════════════════════════

Run these specific checks:

1. hr_whitelist - confirm admin phones exist:
   SELECT phone, access_level FROM hr_whitelist;

2. hr_users - confirm employee records:
   SELECT COUNT(*), MAX(created_at) FROM hr_users;

3. hr_preset_answers - confirm active presets:
   SELECT COUNT(*) FROM hr_preset_answers WHERE is_active = TRUE;

4. content_queue - confirm pipeline integrity:
   SELECT status, COUNT(*) FROM content_queue GROUP BY status;

5. approval_log - confirm history preserved:
   SELECT COUNT(*) FROM approval_log;

═══════════════════════════════════════
PHASE 6: PINECONE SYNC CHECK
═══════════════════════════════════════

hr_embeddings contains pinecone_id references to Pinecone vectors.
After import, check if content_ids still match hr_content.content_id:

SELECT e.pinecone_id, e.content_id, 
       c.content_id as content_exists
FROM hr_embeddings e
LEFT JOIN hr_content c ON e.content_id = c.content_id
WHERE c.content_id IS NULL;

If any orphaned embeddings exist, report them - they may need 
Pinecone re-sync but DO NOT attempt that now.

═══════════════════════════════════════
ROLLBACK PLAN
═══════════════════════════════════════

If ANY phase fails:
- Stop immediately
- Do not proceed to next phase
- Report the exact error
- The old database connection string is preserved in NEON_DATABASE_URL
- We can revert Render DATABASE_URL back to old connection instantly

═══════════════════════════════════════
SUCCESS CRITERIA
═══════════════════════════════════════

Migration is complete only when ALL of these are confirmed:
✅ hr_whitelist has admin records
✅ hr_users row count matches old database
✅ hr_preset_answers active count = 31
✅ content_queue row count = 330
✅ approval_log row count = 420
✅ No import errors reported
✅ Pinecone orphan check completed (even if issues found)

Report final row counts for every table side by side 
(old vs new) before declaring success.