Document the complete flow with:
- File names
- Function names
- Line numbers
- Processing time (if measurable)
- API calls made (if any)

STEP 4: ANALYZE FREE TEXT HANDLERS

Find message_handler for free text input:
```python
@bot.message_handler(content_types=['text'])
async def handle_text(message):
    # What happens here?
```

Questions:
1. Is there a separate handler for free text vs buttons?
2. How does bot distinguish "Ask Your Question" flow from random text?
3. Does free text correctly use preset â†’ RAG flow?

STEP 5: EXAMINE MENU STRUCTURE

Find where bot menus/keyboards are defined:
```python
# Look for InlineKeyboardMarkup definitions
from telebot.types import InlineKeyboardMarkup, InlineKeyboardButton

# Example structure:
def get_salary_menu():
    keyboard = InlineKeyboardMarkup()
    keyboard.add(
        InlineKeyboardButton("ðŸ“… Ð¡Ñ‚Ñ€Ð¾ÐºÐ¸ Ð²Ð¸Ð¿Ð»Ð°Ñ‚Ð¸", callback_data="???")
    )
```

Questions:
1. What are the callback_data values?
2. Are they semantic (e.g., "salary_dates") or query strings (e.g., "ÐºÐ¾Ð»Ð¸ Ð·Ð°Ñ€Ð¿Ð»Ð°Ñ‚Ð°")?
3. Is there a complete mapping of all buttons?

STEP 6: BENCHMARK CURRENT PERFORMANCE

If possible, measure response times:
```python
import time

# For button click:
start = time.time()
# ... handle button click ...
button_time = time.time() - start

# For free text:
start = time.time()
# ... handle free text query ...
text_time = time.time() - start

print(f"Button click: {button_time*1000}ms")
print(f"Free text: {text_time*1000}ms")
```

Expected results:
- Button clicks should be <50ms if direct mapping
- Button clicks >1s indicates RAG/API usage (problem!)
- Free text should be ~2-3s (preset + RAG is normal)

=============================================================================
PHASE 2: IDENTIFY OPTIMIZATION OPPORTUNITIES
=============================================================================

Based on audit findings, identify:

INEFFICIENCY 1: Button Clicks Using RAG
If button clicks trigger RAG system:
- Wasted API calls ($0.002 each)
- Slow response (2-3s vs <10ms)
- Unnecessary complexity
- 99% of user interactions affected

INEFFICIENCY 2: No Separation of Concerns
If buttons and free text use same handler:
- Can't optimize separately
- Mixed concerns
- Harder to maintain

INEFFICIENCY 3: Preset System for Known Content
If buttons convert to query strings then match presets:
- Extra pattern matching overhead
- Risk of wrong preset matching
- Still slower than direct lookup

INEFFICIENCY 4: Video Content Handling
If videos go through RAG:
- Videos should ALWAYS be direct
- No AI needed for "show company values video"

=============================================================================
PHASE 3: DESIGN OPTIMIZED ARCHITECTURE
=============================================================================

PROPOSED ARCHITECTURE:
```python
# ============================================================
# FILE: backend/services/maya_hr_content.py
# ============================================================

# Content database with direct mapping
HR_CONTENT = {
    # Videos (About Company)
    "company_overview": {
        "type": "video",
        "video_url": "BAACAgIAAxkBAAIBB...",  # Telegram file_id
        "caption": "ðŸŽ¥ Ð—Ð°Ð³Ð°Ð»ÑŒÐ½Ð° Ñ–Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ñ–Ñ Ð¿Ñ€Ð¾ AVTD",
        "video_only": True  # Don't send text
    },
    "company_values": {
        "type": "video",
        "video_url": "BAACAgIAAxkBAAIBC...",
        "caption": "ðŸŽ¥ Ð¦Ñ–Ð½Ð½Ð¾ÑÑ‚Ñ– ÐºÐ¾Ð¼Ð¿Ð°Ð½Ñ–Ñ— AVTD",
        "video_only": True
    },
    "company_history": {
        "type": "video",
        "video_url": "BAACAgIAAxkBAAIBD...",
        "caption": "ðŸŽ¥ Ð†ÑÑ‚Ð¾Ñ€Ñ–Ñ ÐºÐ¾Ð¼Ð¿Ð°Ð½Ñ–Ñ— AVTD (25+ Ñ€Ð¾ÐºÑ–Ð²)",
        "video_only": True
    },
    
    # Structured text content
    "company_structure": {
        "type": "text",
        "content": """ðŸ¢ Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° ÐºÐ¾Ð¼Ð¿Ð°Ð½Ñ–Ñ— AVTD

**Ð”ÐµÐ¿Ð°Ñ€Ñ‚Ð°Ð¼ÐµÐ½Ñ‚Ð¸:**
ðŸ­ Ð’Ð¸Ñ€Ð¾Ð±Ð½Ð¸Ñ†Ñ‚Ð²Ð¾
ðŸ“Š ÐŸÑ€Ð¾Ð´Ð°Ð¶Ñ–
ðŸ“£ ÐœÐ°Ñ€ÐºÐµÑ‚Ð¸Ð½Ð³
ðŸ’° Ð¤Ñ–Ð½Ð°Ð½ÑÐ¸, Ð¾Ð±Ð»Ñ–Ðº Ñ‚Ð° Ð°Ð½Ð°Ð»Ñ–Ñ‚Ð¸ÐºÐ°
ðŸ‘¥ ÐŸÐµÑ€ÑÐ¾Ð½Ð°Ð»
ðŸŒ Ð•ÐºÑÐ¿Ð¾Ñ€Ñ‚
ðŸ” Ð‘ÐµÐ·Ð¿ÐµÐºÐ°

**ÐšÐµÑ€Ñ–Ð²Ð½Ð¸Ñ†Ñ‚Ð²Ð¾:**
ðŸ§­ Ð’Ð¸ÐºÐ¾Ð½Ð°Ð²Ñ‡Ð¸Ð¹ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€: Ð’Ð°ÑÐ¸Ð»ÐµÐ½ÐºÐ¾ Ð’.Ð’.
ðŸ“£ Ð”Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€ Ð· Ð¼Ð°Ñ€ÐºÐµÑ‚Ð¸Ð½Ð³Ñƒ: ÐŸÑ€Ð¾Ñ„Ñ–Ñ€ Ð’.Ðœ.
ðŸ“Š Ð”Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€ Ð· Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ñƒ: Ð“Ð¾Ñ† Ð†.Ð¡.
..."""
    },
    
    # Newcomers
    "employment_docs": {
        "type": "text",
        "content": """ðŸ“„ Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¸ Ð´Ð»Ñ Ð¿Ñ€Ð¸Ð¹Ð¾Ð¼Ñƒ Ð½Ð° Ñ€Ð¾Ð±Ð¾Ñ‚Ñƒ:

âœ… 1 Ñ„Ð¾Ñ‚Ð¾ 3Ñ…4
âœ… ÐžÑ€Ð¸Ð³Ñ–Ð½Ð°Ð» Ð¿Ð°ÑÐ¿Ð¾Ñ€Ñ‚Ð° Ð°Ð±Ð¾ ID
âœ… ÐžÑ€Ð¸Ð³Ñ–Ð½Ð°Ð» Ð†ÐŸÐ
âœ… Ð’Ð¸Ð¿Ð¸ÑÐºÐ° Ð¿Ñ€Ð¾ Ð¿Ñ€Ð¾Ð¿Ð¸ÑÐºÑƒ (ÑÐºÑ‰Ð¾ ID)
âœ… Ð”Ð¸Ð¿Ð»Ð¾Ð¼ Ð¿Ñ€Ð¾ Ð²Ð¸Ñ‰Ñƒ Ð¾ÑÐ²Ñ–Ñ‚Ñƒ
âœ… Ð¡Ð²Ñ–Ð´Ð¾Ñ†Ñ‚Ð²Ð¾ Ð¿Ñ€Ð¾ Ð½Ð°Ñ€Ð¾Ð´Ð¶ÐµÐ½Ð½Ñ Ð´Ñ–Ñ‚ÐµÐ¹ (<14 Ñ€Ð¾ÐºÑ–Ð²)
âœ… Ð”Ð¾Ð²Ñ–Ð´ÐºÐ° Ð· ÐŸÐ¤Ð£ Ð¿Ñ€Ð¾ ÑÐ¾Ñ†ÑÑ‚Ñ€Ð°Ñ…ÑƒÐ²Ð°Ð½Ð½Ñ

**Ð†Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ñ–Ñ Ð¾Ñ‚Ñ€Ð¸Ð¼Ð°Ð½Ð½Ñ Ð´Ð¾Ð²Ñ–Ð´ÐºÐ¸ ÐŸÐ¤Ð£:**
1. Ð’ÑÑ‚Ð°Ð½Ð¾Ð²Ñ–Ñ‚ÑŒ Ð´Ð¾Ð´Ð°Ñ‚Ð¾Ðº "ÐŸÐµÐ½ÑÑ–Ð¹Ð½Ð¸Ð¹ Ñ„Ð¾Ð½Ð´"
2. ÐÐ²Ñ‚Ð¾Ñ€Ð¸Ð·ÑƒÐ¹Ñ‚ÐµÑÑŒ Ñ‡ÐµÑ€ÐµÐ· ID Ð±Ð°Ð½ÐºÑƒ
3. ÐŸÐ¾Ð´Ð°Ð¹Ñ‚Ðµ Ð·Ð°Ð¿Ð¸Ñ‚: "Ð²Ð¸Ñ‚ÑÐ³ Ð· Ð•Ð¢Ðš" + Ð´Ð¾Ð²Ñ–Ð´ÐºÐ° Ð¿Ñ€Ð¾ ÑÑ‚Ð°Ð¶
4. Ð—Ð±ÐµÑ€ÐµÐ¶Ñ–Ñ‚ÑŒ PDF
5. ÐŸÐµÑ€ÐµÐ´Ð°Ð¹Ñ‚Ðµ ÐºÐ°Ð´Ñ€Ð¾Ð²Ð¸ÐºÑƒ"""
    },
    
    "corporate_access": {
        "type": "text",
        "content": """ðŸ” ÐšÐ¾Ñ€Ð¿Ð¾Ñ€Ð°Ñ‚Ð¸Ð²Ð½Ð¸Ð¹ Ð´Ð¾ÑÑ‚ÑƒÐ¿ (Ð£Ð—)

**Ð©Ð¾ Ñ†Ðµ:**
Ð›Ð¾Ð³Ñ–Ð½ Ñ– Ð¿Ð°Ñ€Ð¾Ð»ÑŒ Ð´Ð»Ñ:
- Ð£Ð´Ð°Ð»ÐµÐ½Ð¾Ð³Ð¾ Ñ€Ð¾Ð±Ð¾Ñ‡Ð¾Ð³Ð¾ ÑÑ‚Ð¾Ð»Ñƒ (Ð£Ð Ð¡)
- ÐšÐ¾Ñ€Ð¿. Ð¿Ð¾ÑˆÑ‚Ð¸
- Ð¡Ð•Ð” "Ð‘Ð»Ñ–Ñ†"
- Ð”Ð¸Ñ€ÐµÐºÑ‚ÑƒÐ¼ (Ð½Ðµ Ð²ÑÑ–Ð¼)
- Ð£Ñ‡ÐµÑ‚Ð½Ð¸Ñ… ÑÐ¸ÑÑ‚ÐµÐ¼

**Ð¯Ðº Ð·Ð°Ð¼Ð¾Ð²Ð¸Ñ‚Ð¸:**
ðŸ“ž Ð—Ð²ÐµÑ€Ð½ÑƒÑ‚Ð¸ÑÑŒ Ð´Ð¾:
- ÐžÑ„Ñ–Ñ-Ð¼ÐµÐ½ÐµÐ´Ð¶ÐµÑ€Ð° Ñ„Ñ–Ð»Ñ–Ñ—
- Ð¢ÐµÑ€Ð¸Ñ‚Ð¾Ñ€Ñ–Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð¼ÐµÐ½ÐµÐ´Ð¶ÐµÑ€Ð° (Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ñ–)
- Ð ÐµÐ³Ñ–Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ HR (Ð¦Ðž)
- Ð¡Ð¸ÑÐ°Ð´Ð¼Ñ–Ð½Ð° (Ð·Ð°Ð²Ð¾Ð´)

â±ï¸ Ð¡Ñ‚Ð²Ð¾Ñ€ÑŽÑ”Ñ‚ÑŒÑÑ Ð·Ð° 2 Ñ€Ð¾Ð±Ð¾Ñ‡Ñ– Ð´Ð½Ñ– Ð´Ð¾ Ð²Ð¸Ñ…Ð¾Ð´Ñƒ Ð½Ð° Ñ€Ð¾Ð±Ð¾Ñ‚Ñƒ
ðŸ“ Ð—Ð°Ð¿ÑƒÑÐºÐ°Ñ”Ñ‚ÑŒÑÑ ÐœÐ— Ð² Ð¡Ð•Ð” Ð‘Ð»Ñ–Ñ† (ÑˆÐ°Ð±Ð»Ð¾Ð½ â„–114)"""
    },
    
    # Salary
    "salary_payment_dates": {
        "type": "text",
        "content": """ðŸ’° Ð¡Ñ‚Ñ€Ð¾ÐºÐ¸ Ð²Ð¸Ð¿Ð»Ð°Ñ‚Ð¸ Ð·Ð°Ñ€Ð¾Ð±Ñ–Ñ‚Ð½Ð¾Ñ— Ð¿Ð»Ð°Ñ‚Ð¸

ðŸ“… **20-22 Ñ‡Ð¸ÑÐ»Ð° Ð¿Ð¾Ñ‚Ð¾Ñ‡Ð½Ð¾Ð³Ð¾ Ð¼Ñ–ÑÑÑ†Ñ**
ÐÐ²Ð°Ð½Ñ Ð½Ð° Ð½Ð°ÑÑ‚ÑƒÐ¿Ð½Ð¸Ð¹ Ð¼Ñ–ÑÑÑ†ÑŒ

ðŸ“… **5-7 Ñ‡Ð¸ÑÐ»Ð° Ð½Ð°ÑÑ‚ÑƒÐ¿Ð½Ð¾Ð³Ð¾ Ð¼Ñ–ÑÑÑ†Ñ**
Ð—Ð°Ñ€Ð¿Ð»Ð°Ñ‚Ð° Ð·Ð° Ð²Ñ–Ð´Ð¿Ñ€Ð°Ñ†ÑŒÐ¾Ð²Ð°Ð½Ð¸Ð¹ Ð¼Ñ–ÑÑÑ†ÑŒ

Ð’Ð¸Ð¿Ð»Ð°Ñ‚Ð¸ Ð·Ð´Ñ–Ð¹ÑÐ½ÑŽÑŽÑ‚ÑŒÑÑ 2 Ñ€Ð°Ð·Ð¸ Ð½Ð° Ð¼Ñ–ÑÑÑ†ÑŒ Ð·Ð³Ñ–Ð´Ð½Ð¾ Ð·Ð°ÐºÐ¾Ð½Ð¾Ð´Ð°Ð²ÑÑ‚Ð²Ð° Ð£ÐºÑ€Ð°Ñ—Ð½Ð¸."""
    },
    
    "salary_questions": {
        "type": "text",
        "content": """ðŸ’µ ÐŸÐ¸Ñ‚Ð°Ð½Ð½Ñ Ð¿Ð¾ Ð·Ð°Ñ€Ð¿Ð»Ð°Ñ‚Ñ–

**Ð”Ð¾ ÐºÐ¾Ð³Ð¾ Ð·Ð²ÐµÑ€Ñ‚Ð°Ñ‚Ð¸ÑÑŒ:**

ðŸ“Š **Ð”ÐµÐ¿Ð°Ñ€Ñ‚Ð°Ð¼ÐµÐ½Ñ‚ Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ñƒ:**
Ð¤Ñ–Ð½Ð°Ð½ÑÐ¾Ð²Ð¸Ð¹ Ð¼ÐµÐ½ÐµÐ´Ð¶ÐµÑ€ Ñ„Ñ–Ð»Ñ–Ñ—

ðŸ­ **Ð†Ð½ÑˆÑ– Ð´ÐµÐ¿Ð°Ñ€Ñ‚Ð°Ð¼ÐµÐ½Ñ‚Ð¸:**
Ð•ÐºÐ¾Ð½Ð¾Ð¼Ñ–ÑÑ‚ Ð¿Ñ–Ð´Ñ€Ð¾Ð·Ð´Ñ–Ð»Ñƒ

Ð’Ð¾Ð½Ð¸ Ð½Ð°Ð´Ð°ÑŽÑ‚ÑŒ Ð´ÐµÑ‚Ð°Ð»ÑŒÐ½Ñƒ Ñ–Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ñ–ÑŽ Ð¿Ñ€Ð¾ Ð½Ð°Ñ€Ð°Ñ…ÑƒÐ²Ð°Ð½Ð½Ñ Ñ‚Ð° Ñ€Ð¾Ð·Ñ€Ð°Ñ…ÑƒÐ½Ð¾Ðº Ð·Ð°Ñ€Ð¾Ð±Ñ–Ñ‚Ð½Ð¾Ñ— Ð¿Ð»Ð°Ñ‚Ð¸."""
    },
    
    # Tech Support
    "pc_problems": {
        "type": "text",
        "content": """ðŸ–¥ï¸ ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð¸ Ð· ÐŸÐš

**Ð¯ÐºÑ‰Ð¾ Ð½Ðµ Ð¿Ñ€Ð°Ñ†ÑŽÑ” ÐºÐ¾Ð¼Ð¿'ÑŽÑ‚ÐµÑ€, Ñ‚Ð¾Ð½ÐºÐ¸Ð¹ ÐºÐ»Ñ–Ñ”Ð½Ñ‚ Ð°Ð±Ð¾ Ð½Ð¾ÑƒÑ‚Ð±ÑƒÐº:**

ðŸ“ž **Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½:**
- Ð’Ð½ÑƒÑ‚Ñ€Ñ–ÑˆÐ½Ñ–Ð¹: 3636
- ÐœÐ¾Ð±Ñ–Ð»ÑŒÐ½Ð¸Ð¹: +380676235555

ðŸ“§ **Email:**
support@const.dp.ua

âš ï¸ **Ð’Ð°Ð¶Ð»Ð¸Ð²Ð¾:**
Ð†Ð¢ Ð¿Ñ–Ð´Ñ‚Ñ€Ð¸Ð¼ÑƒÑ” Ð¢Ð†Ð›Ð¬ÐšÐ˜ ÐºÐ¾Ñ€Ð¿Ð¾Ñ€Ð°Ñ‚Ð¸Ð²Ð½Ñƒ Ñ‚ÐµÑ…Ð½Ñ–ÐºÑƒ.
Ð— Ð¾ÑÐ¾Ð±Ð¸ÑÑ‚Ð¾ÑŽ Ñ‚ÐµÑ…Ð½Ñ–ÐºÐ¾ÑŽ Ð½Ðµ Ð¿Ñ€Ð°Ñ†ÑŽÑŽÑ‚ÑŒ."""
    },
    
    "sed_blitz": {
        "type": "text",
        "content": """ðŸ“Š Ð¡Ð•Ð” Ð‘Ð»Ñ–Ñ† - Ð¿Ñ–Ð´Ñ‚Ñ€Ð¸Ð¼ÐºÐ°

**ÐŸÑ€Ð¸ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð°Ñ… Ð· Ñ€Ð¾Ð±Ð¾Ñ‚Ð¾ÑŽ Ð¡Ð•Ð” Ð‘Ð»Ñ–Ñ†:**

ðŸ”— **ÐŸÐ¾Ð´Ð°Ñ‚Ð¸ Ð·Ð°ÑÐ²ÐºÑƒ:**
https://tdav.atlassian.net/servicedesk/customer/portals

ðŸ“‚ **Ð Ð¾Ð·Ð´Ñ–Ð»:**
"ÐŸÐ¸Ñ‚Ð°Ð½Ð½Ñ Ð¿Ð¾Ð²'ÑÐ·Ð°Ð½Ñ– Ð· Ð¡Ð•Ð” Ð‘Ð»Ñ–Ñ† / Ð†Ð½ÑˆÑ– Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ"

ðŸ“ **Ð£ Ð·Ð°ÑÐ²Ñ†Ñ–:**
- ÐžÐ¿Ð¸ÑˆÑ–Ñ‚ÑŒ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñƒ
- ÐŸÑ€Ð¸ÐºÑ€Ñ–Ð¿Ñ–Ñ‚ÑŒ ÑÐºÑ€Ñ–Ð½ÑˆÐ¾Ñ‚ (Ð·Ð° Ð¿Ð¾Ñ‚Ñ€ÐµÐ±Ð¸)

ÐŸÑ€Ð¸ Ð¿ÐµÑ€ÑˆÐ¾Ð¼Ñƒ Ð²Ñ…Ð¾Ð´Ñ– Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±Ð½Ð° Ñ€ÐµÑ”ÑÑ‚Ñ€Ð°Ñ†Ñ–Ñ Ð½Ð° Ð¿Ð¾Ñ€Ñ‚Ð°Ð»Ñ–."""
    },
    
    "urs_setup": {
        "type": "text",
        "content": """ðŸŒ ÐÐ°Ð»Ð°ÑˆÑ‚ÑƒÐ²Ð°Ð½Ð½Ñ Ð£Ð Ð¡ (ÑƒÐ´Ð°Ð»ÐµÐ½ÐºÐ¸)

ðŸ“„ **Ð†Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ñ–Ñ:**
http://docs.google.com/document/d/1DSgEljpUkojs7M0LwsLV4UTOiwWOp7io/edit

ðŸ“¥ **Ð—Ð°Ð²Ð°Ð½Ñ‚Ð°Ð¶Ð¸Ñ‚Ð¸ Forti:**
http://drive.google.com/file/d/1q5kc4BMt1SlSD1XyLLPmEG1da4zTfB9Y/view

**Ð¯ÐºÑ‰Ð¾ Ð½Ðµ Ð¿Ñ€Ð°Ñ†ÑŽÑ” Ð½Ð° ÐºÐ¾Ñ€Ð¿. Ñ‚ÐµÑ…Ð½Ñ–Ñ†Ñ–:**
ðŸ“ž 3636 Ð°Ð±Ð¾ +380676235555
ðŸ“§ support@const.dp.ua

**Ð¯ÐºÑ‰Ð¾ Ð½Ð° Ð¾ÑÐ¾Ð±Ð¸ÑÑ‚Ð¾Ð¼Ñƒ ÐŸÐš:**
ðŸ”— https://tdav.atlassian.net/servicedesk/customer/portals
Ð Ð¾Ð·Ð´Ñ–Ð»: "ÐŸÐ¸Ñ‚Ð°Ð½Ð½Ñ Ð¿Ð¾Ð²'ÑÐ·Ð°Ð½Ñ– Ð· Ð²Ð¸Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð½ÑÐ¼ ÐŸÐ—" """
    },
    
    "office_supplies": {
        "type": "text",
        "content": """âœï¸ Ð—Ð°Ð¼Ð¾Ð²Ð»ÐµÐ½Ð½Ñ ÐºÐ°Ð½Ñ†Ñ‚Ð¾Ð²Ð°Ñ€Ñ–Ð²

**ÐŸÑ€Ð¾Ñ†ÐµÑ Ð·Ð°Ð¼Ð¾Ð²Ð»ÐµÐ½Ð½Ñ:**

ðŸ“… **ÐšÐ¾Ð»Ð¸:** ~10 Ñ‡Ð¸ÑÐ»Ð° ÐºÐ¾Ð¶Ð½Ð¾Ð³Ð¾ Ð¼Ñ–ÑÑÑ†Ñ

ðŸ“ **Ð¥Ñ‚Ð¾ Ñ„Ð¾Ñ€Ð¼ÑƒÑ” Ð·Ð°ÑÐ²ÐºÑƒ:**
- ÐžÑ„Ñ–Ñ-Ð¼ÐµÐ½ÐµÐ´Ð¶ÐµÑ€ Ñ„Ñ–Ð»Ñ–Ñ—
- Ð¢ÐµÑ€Ð¸Ñ‚Ð¾Ñ€Ñ–Ð°Ð»ÑŒÐ½Ð¸Ð¹ Ð¼ÐµÐ½ÐµÐ´Ð¶ÐµÑ€
- Ð’Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ð°Ð»ÑŒÐ½Ð° Ð¾ÑÐ¾Ð±Ð° Ð½Ð° Ð·Ð°Ð²Ð¾Ð´Ñ–

ðŸ“§ **ÐšÐ¾Ð¼Ñƒ Ð²Ñ–Ð´Ð¿Ñ€Ð°Ð²Ð¸Ñ‚Ð¸:**
Ð¡ÐµÐºÑ€ÐµÑ‚Ð°Ñ€ÑŽ Ð±Ñ–Ð·Ð½ÐµÑÑƒ

â±ï¸ **Ð¡Ñ‚Ñ€Ð¾Ðº Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸:** 2-3 Ñ‚Ð¸Ð¶Ð½Ñ–"""
    },
    
    "kpk_tablet": {
        "type": "text",
        "content": """ðŸ“± ÐšÐŸÐš / ÐŸÐ»Ð°Ð½ÑˆÐµÑ‚ - Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð¸

**Ð¯ÐºÑ‰Ð¾ Ð½Ðµ Ð¿Ñ€Ð°Ñ†ÑŽÑ” Ð¿Ñ€Ð¸ÑÑ‚Ñ€Ñ–Ð¹:**

ðŸ“ž **Ð—Ð²ÐµÑ€Ð½ÑƒÑ‚Ð¸ÑÑŒ Ð´Ð¾:**
- ÐÐ½Ð°Ð»Ñ–Ñ‚Ð¸ÐºÐ°
- Ð¢ÐµÑ€Ð¸Ñ‚Ð¾Ñ€Ñ–Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð¼ÐµÐ½ÐµÐ´Ð¶ÐµÑ€Ð°
- Ð ÐµÐ³Ñ–Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ ÑÑƒÐ¿ÐµÑ€Ð²Ð°Ð¹Ð·ÐµÑ€Ð°

Ð’Ð¾Ð½Ð¸ Ð´Ð¾Ð¿Ð¾Ð¼Ð¾Ð¶ÑƒÑ‚ÑŒ Ð· Ð²Ñ–Ð´Ð½Ð¾Ð²Ð»ÐµÐ½Ð½ÑÐ¼ Ð°Ð±Ð¾ Ð·Ð°Ð¼Ñ–Ð½Ð¾ÑŽ.

**Ð¯ÐºÑ‰Ð¾ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð° Ð· ÐœÐ¾Ð±Ñ–Ð»ÑŒÐ½Ð¾ÑŽ Ð¢Ð¾Ñ€Ð³Ñ–Ð²Ð»ÐµÑŽ:**
(Ð¿Ð¾Ð¼Ð¸Ð»ÐºÐ¸ Ð¿Ñ€Ð¸ Ð·Ð°Ð²Ð°Ð½Ñ‚Ð°Ð¶ÐµÐ½Ð½Ñ–/Ð²Ð¸Ð³Ñ€ÑƒÐ·Ñ†Ñ–, Ð½ÐµÐºÐ¾Ñ€ÐµÐºÑ‚Ð½Ñ– Ð´Ð°Ð½Ñ–)

ðŸ“ž ÐÐ½Ð°Ð»Ñ–Ñ‚Ð¸Ðº / Ð¢Ðœ / Ñ€ÐµÐ³Ñ–Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¸Ð¹ Ð°Ð½Ð°Ð»Ñ–Ñ‚Ð¸Ðº Ð·Ð½Ð°ÑŽÑ‚ÑŒ ÐºÑƒÐ´Ð¸ Ð·Ð²ÐµÑ€Ð½ÑƒÑ‚Ð¸ÑÑŒ."""
    },
}

# Menu structure with callback_data keys
HR_MENUS = {
    "main_menu": {
        "text": "â¤ï¸ **Maya HR** â€” Ð²Ð°Ñˆ Ð¿Ð¾Ð¼Ñ–Ñ‡Ð½Ð¸Ðº Ð· HR Ð¿Ð¸Ñ‚Ð°Ð½ÑŒ\n\nÐžÐ±ÐµÑ€Ñ–Ñ‚ÑŒ Ñ€Ð¾Ð·Ð´Ñ–Ð»:",
        "buttons": [
            [{"text": "ðŸ“‹ ÐŸÑ€Ð¾ ÐºÐ¾Ð¼Ð¿Ð°Ð½Ñ–ÑŽ", "callback_data": "menu_about"}],
            [{"text": "ðŸ‘” ÐÐ¾Ð²Ð°Ñ‡ÐºÐ°Ð¼", "callback_data": "menu_newcomers"}],
            [{"text": "ðŸ’¼ Ð Ð¾Ð±Ð¾Ñ‡Ñ– Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ", "callback_data": "menu_work"}],
            [{"text": "ðŸ’» Ð¢ÐµÑ….Ð¿Ñ–Ð´Ñ‚Ñ€Ð¸Ð¼ÐºÐ°", "callback_data": "menu_tech"}],
            [{"text": "ðŸ“ž ÐšÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ð¸", "callback_data": "menu_contacts"}],
            [{"text": "âš–ï¸ Ð®Ñ€.Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¸", "callback_data": "menu_legal"}],
            [{"text": "ðŸ’¬ Ð—Ð°Ð´Ð°Ñ‚Ð¸ ÑÐ²Ð¾Ñ” Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ", "callback_data": "free_text_mode"}]
        ]
    },
    
    "menu_about": {
        "text": "ðŸ“‹ **ÐŸÑ€Ð¾ ÐºÐ¾Ð¼Ð¿Ð°Ð½Ñ–ÑŽ AVTD**\n\nÐžÐ±ÐµÑ€Ñ–Ñ‚ÑŒ Ñ‚ÐµÐ¼Ñƒ:",
        "buttons": [
            [{"text": "ðŸŽ¯ Ð—Ð°Ð³Ð°Ð»ÑŒÐ½Ð° Ñ–Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ñ–Ñ", "callback_data": "company_overview"}],
            [{"text": "ðŸ’Ž Ð¦Ñ–Ð½Ð½Ð¾ÑÑ‚Ñ–", "callback_data": "company_values"}],
            [{"text": "ðŸ“œ Ð†ÑÑ‚Ð¾Ñ€Ñ–Ñ", "callback_data": "company_history"}],
            [{"text": "ðŸ¢ Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð°", "callback_data": "company_structure"}],
            [{"text": "â—€ï¸ ÐÐ°Ð·Ð°Ð´", "callback_data": "main_menu"}]
        ]
    },
    
    "menu_newcomers": {
        "text": "ðŸ‘” **Ð†Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ñ–Ñ Ð´Ð»Ñ Ð½Ð¾Ð²Ð°Ñ‡ÐºÑ–Ð²**\n\nÐžÐ±ÐµÑ€Ñ–Ñ‚ÑŒ Ñ‚ÐµÐ¼Ñƒ:",
        "buttons": [
            [{"text": "ðŸ“„ Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¸ Ð´Ð»Ñ Ð¿Ñ€Ð¸Ð¹Ð¾Ð¼Ñƒ", "callback_data": "employment_docs"}],
            [{"text": "ðŸ” ÐšÐ¾Ñ€Ð¿Ð¾Ñ€Ð°Ñ‚Ð¸Ð²Ð½Ð¸Ð¹ Ð´Ð¾ÑÑ‚ÑƒÐ¿", "callback_data": "corporate_access"}],
            [{"text": "ðŸ‘£ ÐŸÐµÑ€ÑˆÑ– ÐºÑ€Ð¾ÐºÐ¸", "callback_data": "first_steps"}],
            [{"text": "â—€ï¸ ÐÐ°Ð·Ð°Ð´", "callback_data": "main_menu"}]
        ]
    },
    
    "menu_work": {
        "text": "ðŸ’¼ **Ð Ð¾Ð±Ð¾Ñ‡Ñ– Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ**\n\nÐžÐ±ÐµÑ€Ñ–Ñ‚ÑŒ Ñ‚ÐµÐ¼Ñƒ:",
        "buttons": [
            [{"text": "ðŸ’° Ð—Ð°Ñ€Ð¿Ð»Ð°Ñ‚Ð°", "callback_data": "menu_salary"}],
            [{"text": "ðŸ–ï¸ Ð’Ñ–Ð´Ð¿ÑƒÑÑ‚ÐºÐ°", "callback_data": "vacation"}],
            [{"text": "ðŸ¥ Ð›Ñ–ÐºÐ°Ñ€Ð½ÑÐ½Ð¸Ð¹", "callback_data": "sick_leave"}],
            [{"text": "ðŸ  Ð’Ñ–Ð´Ð´Ð°Ð»ÐµÐ½Ð° Ñ€Ð¾Ð±Ð¾Ñ‚Ð°", "callback_data": "remote_work"}],
            [{"text": "âœˆï¸ Ð’Ñ–Ð´Ñ€ÑÐ´Ð¶ÐµÐ½Ð½Ñ", "callback_data": "business_trip"}],
            [{"text": "â—€ï¸ ÐÐ°Ð·Ð°Ð´", "callback_data": "main_menu"}]
        ]
    },
    
    "menu_salary": {
        "text": "ðŸ’° **ÐŸÐ¸Ñ‚Ð°Ð½Ð½Ñ Ð¿Ð¾ Ð·Ð°Ñ€Ð¿Ð»Ð°Ñ‚Ñ–**\n\nÐžÐ±ÐµÑ€Ñ–Ñ‚ÑŒ Ñ‚ÐµÐ¼Ñƒ:",
        "buttons": [
            [{"text": "ðŸ“… Ð¡Ñ‚Ñ€Ð¾ÐºÐ¸ Ð²Ð¸Ð¿Ð»Ð°Ñ‚Ð¸", "callback_data": "salary_payment_dates"}],
            [{"text": "ðŸ’µ Ð”Ð¾ ÐºÐ¾Ð³Ð¾ Ð·Ð²ÐµÑ€Ñ‚Ð°Ñ‚Ð¸ÑÑŒ", "callback_data": "salary_questions"}],
            [{"text": "â—€ï¸ ÐÐ°Ð·Ð°Ð´", "callback_data": "menu_work"}]
        ]
    },
    
    "menu_tech": {
        "text": "ðŸ’» **Ð¢ÐµÑ…Ð½Ñ–Ñ‡Ð½Ð° Ð¿Ñ–Ð´Ñ‚Ñ€Ð¸Ð¼ÐºÐ°**\n\nÐžÐ±ÐµÑ€Ñ–Ñ‚ÑŒ Ñ‚ÐµÐ¼Ñƒ:",
        "buttons": [
            [{"text": "ðŸ–¥ï¸ ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð¸ Ð· ÐŸÐš", "callback_data": "pc_problems"}],
            [{"text": "ðŸ“± ÐšÐŸÐš/ÐŸÐ»Ð°Ð½ÑˆÐµÑ‚", "callback_data": "kpk_tablet"}],
            [{"text": "ðŸ“Š Ð¡Ð•Ð” Ð‘Ð»Ñ–Ñ†", "callback_data": "sed_blitz"}],
            [{"text": "ðŸŒ ÐÐ°Ð»Ð°ÑˆÑ‚ÑƒÐ²Ð°Ð½Ð½Ñ Ð£Ð Ð¡", "callback_data": "urs_setup"}],
            [{"text": "âœï¸ ÐšÐ°Ð½Ñ†Ñ‚Ð¾Ð²Ð°Ñ€Ð¸", "callback_data": "office_supplies"}],
            [{"text": "â—€ï¸ ÐÐ°Ð·Ð°Ð´", "callback_data": "main_menu"}]
        ]
    },
}


# ============================================================
# FILE: backend/services/maya_hr_bot.py
# ============================================================

from telebot.async_telebot import AsyncTeleBot
from telebot.types import InlineKeyboardMarkup, InlineKeyboardButton
from .maya_hr_content import HR_CONTENT, HR_MENUS
from .hr_rag_service import search_hr_content  # Only for free text

bot = AsyncTeleBot(TELEGRAM_BOT_TOKEN)

# User state management (for free text mode)
user_states = {}

def create_keyboard(menu_key: str):
    """Create keyboard from menu definition"""
    menu = HR_MENUS[menu_key]
    keyboard = InlineKeyboardMarkup()
    
    for row in menu["buttons"]:
        keyboard.row(*[
            InlineKeyboardButton(btn["text"], callback_data=btn["callback_data"])
            for btn in row
        ])
    
    return keyboard

@bot.message_handler(commands=['start'])
async def start_command(message):
    """Start command - show main menu"""
    keyboard = create_keyboard("main_menu")
    await bot.send_message(
        message.chat.id,
        HR_MENUS["main_menu"]["text"],
        reply_markup=keyboard,
        parse_mode="Markdown"
    )

@bot.callback_query_handler(func=lambda call: True)
async def handle_button_click(call):
    """
    Handle ALL button clicks with direct mapping
    No RAG, no preset matching - just instant content delivery
    """
    
    callback_data = call.data
    chat_id = call.message.chat.id
    
    # SPECIAL CASE 1: Menu navigation
    if callback_data.startswith("menu_"):
        menu_key = callback_data
        keyboard = create_keyboard(menu_key)
        await bot.edit_message_text(
            HR_MENUS[menu_key]["text"],
            chat_id,
            call.message.message_id,
            reply_markup=keyboard,
            parse_mode="Markdown"
        )
        return
    
    # SPECIAL CASE 2: Main menu
    if callback_data == "main_menu":
        keyboard = create_keyboard("main_menu")
        await bot.edit_message_text(
            HR_MENUS["main_menu"]["text"],
            chat_id,
            call.message.message_id,
            reply_markup=keyboard,
            parse_mode="Markdown"
        )
        return
    
    # SPECIAL CASE 3: Free text mode activation
    if callback_data == "free_text_mode":
        user_states[call.from_user.id] = "free_text"
        await bot.send_message(
            chat_id,
            "ðŸ’¬ **Ð—Ð°Ð´Ð°Ð¹Ñ‚Ðµ ÑÐ²Ð¾Ñ” Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ**\n\n"
            "ÐÐ°Ð¿Ð¸ÑˆÑ–Ñ‚ÑŒ Ñ‚ÐµÐºÑÑ‚Ð¾Ð¼ Ñ‰Ð¾ Ð²Ð°Ñ Ñ†Ñ–ÐºÐ°Ð²Ð¸Ñ‚ÑŒ, Ñ– Ñ ÑÐ¿Ñ€Ð¾Ð±ÑƒÑŽ Ð·Ð½Ð°Ð¹Ñ‚Ð¸ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´ÑŒ.\n\n"
            "Ð©Ð¾Ð± Ð¿Ð¾Ð²ÐµÑ€Ð½ÑƒÑ‚Ð¸ÑÑŒ Ð´Ð¾ Ð¼ÐµÐ½ÑŽ, Ð²Ñ–Ð´Ð¿Ñ€Ð°Ð²Ñ‚Ðµ /menu",
            parse_mode="Markdown"
        )
        return
    
    # MAIN LOGIC: Direct content mapping
    if callback_data in HR_CONTENT:
        content = HR_CONTENT[callback_data]
        
        if content["type"] == "video":
            # Send video only (no text)
            await bot.send_video(
                chat_id,
                content["video_url"],
                caption=content["caption"]
            )
            
        elif content["type"] == "text":
            # Send text content
            # Add "Back" button
            keyboard = InlineKeyboardMarkup()
            keyboard.add(InlineKeyboardButton("â—€ï¸ ÐÐ°Ð·Ð°Ð´ Ð´Ð¾ Ð¼ÐµÐ½ÑŽ", callback_data="main_menu"))
            
            await bot.send_message(
                chat_id,
                content["content"],
                reply_markup=keyboard,
                parse_mode="Markdown"
            )
    else:
        # Unknown callback_data
        await bot.answer_callback_query(
            call.id,
            "âš ï¸ ÐšÐ¾Ð½Ñ‚ÐµÐ½Ñ‚ Ð½Ðµ Ð·Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾. Ð—Ð²ÐµÑ€Ð½Ñ–Ñ‚ÑŒÑÑ Ð´Ð¾ HR.",
            show_alert=True
        )

@bot.message_handler(commands=['menu'])
async def menu_command(message):
    """Return to main menu"""
    user_states.pop(message.from_user.id, None)  # Exit free text mode
    await start_command(message)

@bot.message_handler(content_types=['text'])
async def handle_free_text(message):
    """
    Handle free text input
    ONLY active when user is in "free_text_mode"
    Uses preset â†’ RAG flow
    """
    
    user_id = message.from_user.id
    chat_id = message.chat.id
    
    # Check if user is in free text mode
    if user_states.get(user_id) != "free_text":
        # User sent random text, redirect to menu
        await bot.send_message(
            chat_id,
            "Ð¡ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð¹Ñ‚ÐµÑÑŒ Ð¼ÐµÐ½ÑŽ Ð´Ð»Ñ Ð½Ð°Ð²Ñ–Ð³Ð°Ñ†Ñ–Ñ— ðŸ‘‡",
            reply_markup=create_keyboard("main_menu")
        )
        return
    
    # User is in free text mode - use preset/RAG
    query = message.text
    
    # Send "typing..." indicator
    await bot.send_chat_action(chat_id, "typing")
    
    try:
        # Search through presets first, then RAG
        answer = await search_hr_content(query)
        
        # Add feedback buttons
        keyboard = InlineKeyboardMarkup()
        keyboard.row(
            InlineKeyboardButton("ðŸ‘ ÐšÐ¾Ñ€Ð¸ÑÐ½Ð¾", callback_data=f"feedback_pos:{query[:50]}"),
            InlineKeyboardButton("ðŸ‘Ž ÐÐµ Ñ‚Ðµ", callback_data=f"feedback_neg:{query[:50]}")
        )
        keyboard.add(InlineKeyboardButton("â—€ï¸ ÐÐ°Ð·Ð°Ð´ Ð´Ð¾ Ð¼ÐµÐ½ÑŽ", callback_data="main_menu"))
        
        await bot.send_message(
            chat_id,
            answer,
            reply_markup=keyboard,
            parse_mode="Markdown"
        )
        
    except Exception as e:
        await bot.send_message(
            chat_id,
            "âš ï¸ Ð’Ð¸Ð±Ð°Ñ‡Ñ‚Ðµ, Ð²Ð¸Ð½Ð¸ÐºÐ»Ð° Ð¿Ð¾Ð¼Ð¸Ð»ÐºÐ° Ð¿Ñ€Ð¸ Ð¿Ð¾ÑˆÑƒÐºÑƒ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ñ–.\n"
            "Ð¡Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ñ–Ð½ÑˆÐµ Ñ„Ð¾Ñ€Ð¼ÑƒÐ»ÑŽÐ²Ð°Ð½Ð½Ñ Ð°Ð±Ð¾ Ð·Ð²ÐµÑ€Ð½Ñ–Ñ‚ÑŒÑÑ Ð´Ð¾ HR: @natalia",
            reply_markup=create_keyboard("main_menu")
        )


# ============================================================
# Performance Comparison
# ============================================================

"""
BEFORE OPTIMIZATION (if using RAG for buttons):
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Button click: [ðŸ“… Ð¡Ñ‚Ñ€Ð¾ÐºÐ¸ Ð²Ð¸Ð¿Ð»Ð°Ñ‚Ð¸]
    â†“ convert to query: "ÑÑ‚Ñ€Ð¾ÐºÐ¸ Ð²Ð¸Ð¿Ð»Ð°Ñ‚Ð¸ Ð·Ð¿"
    â†“ generate embedding: 500ms, $0.0001
    â†“ vector search: 50ms
    â†“ LLM synthesis: 2000ms, $0.002
    â†“ response
Total: ~2.5s, $0.0021

For 800 employees Ã— 10 queries/month = 8,000 queries
Cost: 8,000 Ã— $0.0021 = $16.80/month
UX: Slow, frustrating

AFTER OPTIMIZATION (direct mapping):
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Button click: [ðŸ“… Ð¡Ñ‚Ñ€Ð¾ÐºÐ¸ Ð²Ð¸Ð¿Ð»Ð°Ñ‚Ð¸]
    â†“ lookup: callback_data = "salary_payment_dates"
    â†“ HR_CONTENT["salary_payment_dates"]
    â†“ response
Total: <10ms, $0

For 8,000 queries (99% buttons, 1% free text)
Cost: 7,920 Ã— $0 + 80 Ã— $0.002 = $0.16/month
UX: Instant, delightful

SAVINGS: $16.64/month, 250x faster, better UX
"""
```

=============================================================================
PHASE 4: IMPLEMENTATION STEPS
=============================================================================

STEP 1: Create maya_hr_content.py
- Copy HR_CONTENT dictionary above
- Copy HR_MENUS dictionary above
- Ensure all content from knowledge base is included

STEP 2: Refactor maya_hr_bot.py
- Implement direct button handling as shown
- Add user state management for free text mode
- Remove RAG/preset calls from button handlers

STEP 3: Test Each Button Path
For each button in the menu:
â–¡ Click button
â–¡ Verify instant response (<50ms)
â–¡ Verify correct content displayed
â–¡ Verify "Back" navigation works
â–¡ Verify videos play correctly

STEP 4: Test Free Text Mode
â–¡ Click "ðŸ’¬ Ð—Ð°Ð´Ð°Ñ‚Ð¸ ÑÐ²Ð¾Ñ” Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ"
â–¡ Send test queries
â–¡ Verify preset/RAG flow works
â–¡ Verify feedback buttons work
â–¡ Verify return to menu works

STEP 5: Benchmark Performance
```python
import time
from statistics import mean

# Test 100 button clicks
button_times = []
for i in range(100):
    start = time.time()
    # ... simulate button click ...
    button_times.append(time.time() - start)

# Test 20 free text queries
text_times = []
for i in range(20):
    start = time.time()
    # ... simulate free text query ...
    text_times.append(time.time() - start)

print(f"Button avg: {mean(button_times)*1000:.1f}ms")
print(f"Free text avg: {mean(text_times)*1000:.1f}ms")
```

Expected results:
- Button clicks: <50ms average
- Free text: 2000-3000ms average

=============================================================================
PHASE 5: CLEANUP
=============================================================================

After optimization, remove/simplify:

1. **Preset patterns for button content**
   - Keep presets only for free text variations
   - Remove presets that match button labels

2. **Content ID references**
   - Direct content in HR_CONTENT dict
   - No need for database lookups for buttons

3. **Complex routing logic**
   - Simpler codebase
   - Easier to maintain

=============================================================================
DELIVERABLES
=============================================================================

1. Complete audit report:
   - Current architecture diagram
   - Identified inefficiencies
   - Performance measurements

2. Optimized implementation:
   - maya_hr_content.py with complete content map
   - Refactored maya_hr_bot.py with direct mapping
   - User state management for free text mode

3. Test results:
   - All button paths tested
   - Free text mode tested
   - Performance benchmarks

4. Cost/performance comparison:
   - Before vs after metrics
   - Estimated monthly savings
   - UX improvements

BEGIN ARCHITECTURAL AUDIT NOW.