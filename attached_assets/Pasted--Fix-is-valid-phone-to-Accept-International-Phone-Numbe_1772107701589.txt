# Fix is_valid_phone to Accept International Phone Numbers

## PROBLEM
The `is_valid_phone` function in `backend/services/hr_auth.py` only accepts Ukrainian phone numbers (exactly 12 digits), causing phone detection to fail for international numbers.

**Current behavior:**
- `+380501234567` (12 digits) → Valid ✅
- `+34 692 480 784` (11 digits) → Invalid ❌
- Result: Authenticated users with non-Ukrainian phones don't trigger phone detection

**Logs showing the issue:**
```
User: +34 692 480 784
AUTH_CHECK: OK (authenticated)
MSG_ROUTED → HR RAG (should have detected phone!)
```

## ROOT CAUSE

Line 19-23 in `backend/services/hr_auth.py`:
```python
def is_valid_phone(phone: str) -> bool:
    try:
        normalized = normalize_phone(phone)
        return len(normalized) == 12  # ← TOO STRICT! Only Ukrainian format
    except ValueError:
        return False
```

## SOLUTION

Update `is_valid_phone` to accept international phone numbers (10-15 digits):
```python
import re

def is_valid_phone(phone: str) -> bool:
    """
    Validate if text is a phone number.
    
    Accepts international formats with 10-15 digits:
    - Ukrainian: 0501234567 (10), 380501234567 (12)
    - Spanish: 34692480784 (11)
    - UK: 447700900123 (12)
    - US: 12025551234 (11)
    
    Args:
        phone: Phone number string (with or without formatting)
    
    Returns:
        True if valid phone number format, False otherwise
    """
    if not phone or not isinstance(phone, str):
        return False
    
    try:
        # Remove all non-digit characters except leading +
        cleaned = phone.strip()
        
        # Extract only digits
        digits = re.sub(r'\D', '', cleaned)
        
        # Valid phone: 10-15 digits
        # 10 = minimum (local format)
        # 15 = maximum (international with country code)
        if not (10 <= len(digits) <= 15):
            return False
        
        # Additional validation: must start with digit (not just spaces/symbols)
        if not re.search(r'\d', phone):
            return False
        
        return True
        
    except Exception as e:
        logger.debug(f"Phone validation error for '{phone[:10]}...': {e}")
        return False
```

## TESTING

Add test cases to verify the fix works:
```python
# Test cases (can add to a test script or manual testing):
test_cases = [
    # Ukrainian formats
    ("0501234567", True),           # Local format
    ("380501234567", True),         # International
    ("+380501234567", True),        # With +
    ("+380 50 123 45 67", True),    # With spaces
    
    # International formats
    ("+34 692 480 784", True),      # Spanish (Konstantin's number)
    ("+44 7700 900123", True),      # UK
    ("+1 202 555 1234", True),      # US
    ("34692480784", True),          # Spanish without +
    
    # Invalid
    ("123", False),                 # Too short
    ("12345678901234567", False),   # Too long (17 digits)
    ("Hello", False),               # Not a number
    ("", False),                    # Empty
    ("+", False),                   # Just +
]

for phone, expected in test_cases:
    result = is_valid_phone(phone)
    status = "✅" if result == expected else "❌"
    print(f"{status} is_valid_phone('{phone}') = {result} (expected {expected})")
```

## VALIDATION

After implementing, test in Telegram:

**Test 1: Spanish number (authenticated user)**
```
User (Konstantin): +34 692 480 784
Expected log: AUTH_USER_PHONE: telegram_id=441389791
Expected message: "✅ Ви вже авторизовані як Konstantin Kovalchuk"
```

**Test 2: Ukrainian number (authenticated user)**
```
User: +380501234567
Expected: Same confirmation message
```

**Test 3: Invalid input**
```
User: "Hello"
Expected: Routes to HR RAG (not detected as phone)
```

## SUCCESS CRITERIA

✅ `is_valid_phone("+34 692 480 784")` returns True
✅ `is_valid_phone("+380501234567")` returns True  
✅ `is_valid_phone("0501234567")` returns True
✅ `is_valid_phone("Hello")` returns False
✅ Authenticated users sending ANY valid phone see confirmation message
✅ Phone detection works regardless of country code

## DEPLOYMENT

After implementing:
1. Verify changes in Replit
2. Commit: `git add backend/services/hr_auth.py`
3. Commit: `git commit -m "Fix: Accept international phone numbers in is_valid_phone (10-15 digits)"`
4. Push: `git push`
5. Wait for Render auto-deploy (~2 min)
6. Test in production Telegram