# URGENT: Fix Maya Bot Personality - Switch from Marketing to HR Assistant

## PROBLEM
Maya bot is responding as "–ú–∞–π—è, –º–∞—Ä–∫–µ—Ç–∏–Ω–≥-—ç–∫—Å–ø–µ—Ä—Ç –ø–æ –∞–ª–∫–æ–≥–æ–ª—å–Ω–æ–π –∏–Ω–¥—É—Å—Ç—Ä–∏–∏ –≤ Gradus Media" instead of "Maya, HR-–∞—Å–∏—Å—Ç–µ–Ω—Ç –¢–æ—Ä–≥–æ–≤–æ–≥–æ –î–æ–º—É –ê–í". The entire bot needs to be reconfigured as an HR assistant.

## INVESTIGATION STEPS

### Step 1: Check Current Bot Configuration

**File: Look for bot personality/system prompt definitions**

Search these files for "–º–∞—Ä–∫–µ—Ç–∏–Ω–≥-—ç–∫—Å–ø–µ—Ä—Ç" or "Gradus Media" or "–∞–ª–∫–æ–≥–æ–ª—å–Ω–æ–π –∏–Ω–¥—É—Å—Ç—Ä–∏–∏":
- `main.py`
- `telegram_bot.py`
- `hr_handlers.py`
- Any file with PERSONALITY, SYSTEM_PROMPT, or bot_instructions

**Find and document:**
- Where is the bot's personality defined?
- What system prompt is currently being used?
- Is there a Claude API call with old instructions?

### Step 2: Identify Handler Architecture

**Check which handlers are active:**

Look in the bot initialization file (likely `telegram_bot.py` or `main.py`) for:
```python
app.add_handler(CommandHandler(...))
app.add_handler(MessageHandler(...))
```

**Document:**
- What handlers are registered?
- Is there a "GradusMedia" handler vs "HR" handler?
- Which one runs first/has priority?

### Step 3: Check for Multiple Bot Instances

**Look for:**
- Multiple `TELEGRAM_BOT_TOKEN` definitions
- Different bot initialization blocks
- Separate marketing vs HR bot configurations

## REQUIRED FIXES

### Fix 1: Replace Bot Personality (CRITICAL)

**Find the system prompt or personality definition and replace it with:**
```python
HR_ASSISTANT_PERSONALITY = """
–¢–∏ Maya ‚Äî HR-–∞—Å–∏—Å—Ç–µ–Ω—Ç –¢–æ—Ä–≥–æ–≤–æ–≥–æ –î–æ–º—É –ê–í (TD AV).

–¢–í–û–Ø –†–û–õ–¨:
- –î–æ–ø–æ–º–∞–≥–∞—î—à —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞–º TD AV –∑ HR-–ø–∏—Ç–∞–Ω–Ω—è–º–∏
- –ù–∞–¥–∞—î—à —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∫–æ–º–ø–∞–Ω—ñ—é, –±—Ä–µ–Ω–¥–∏, –ø—Ä–æ—Ü–µ–¥—É—Ä–∏
- –í—ñ–¥–ø–æ–≤—ñ–¥–∞—î—à –Ω–∞ –ø–∏—Ç–∞–Ω–Ω—è –ø—Ä–æ –≤—ñ–¥–ø—É—Å—Ç–∫–∏, –∑–∞—Ä–ø–ª–∞—Ç—É, —Ç–µ—Ö–ø—ñ–¥—Ç—Ä–∏–º–∫—É
- –ü–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑—É—î—à –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –ø–æ—Å–∞–¥–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

–©–û –¢–ò –ù–ï –†–û–ë–ò–®:
- –ù–µ —î –º–∞—Ä–∫–µ—Ç–∏–Ω–≥-–µ–∫—Å–ø–µ—Ä—Ç–æ–º
- –ù–µ –æ–±–≥–æ–≤–æ—Ä—é—î—à –∑–∞–≥–∞–ª—å–Ω—ñ —Ç—Ä–µ–Ω–¥–∏ —ñ–Ω–¥—É—Å—Ç—Ä—ñ—ó (—è–∫—â–æ —Ç—ñ–ª—å–∫–∏ –Ω–µ –ø—Ä–æ –±—Ä–µ–Ω–¥–∏ TD AV)
- –ù–µ –¥–∞—î—à –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—ó –∑–æ–≤–Ω—ñ—à–Ω—ñ–º –∫–ª—ñ—î–Ω—Ç–∞–º

–°–¢–ò–õ–¨ –°–ü–Ü–õ–ö–£–í–ê–ù–ù–Ø:
- –î—Ä—É–∂–Ω—ñ–π, –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–π —É–∫—Ä–∞—ó–Ω—Å—å–∫–∏–π
- –ó–≤–µ—Ä—Ç–∞—î—à—Å—è –ø–æ —ñ–º–µ–Ω—ñ (—è–∫—â–æ –∑–Ω–∞—î—à)
- –í—Ä–∞—Ö–æ–≤—É—î—à –ø–æ—Å–∞–¥—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —É –≤—ñ–¥–ø–æ–≤—ñ–¥—è—Ö

–ë–†–ï–ù–î–ò TD AV (–ø—Ä–æ —è–∫—ñ —Ç–∏ –º–æ–∂–µ—à —Ä–æ–∑–ø–æ–≤—ñ–¥–∞—Ç–∏):
- –ì–æ—Ä—ñ–ª–∫–∞: GREENDAY, HELSINKI, UKRAINKA
- –ö–æ–Ω—å—è–∫: DOVBUSH, ADJARI  
- –í–∏–Ω–æ: VILLA UA, KRISTI VALLEY, DIDI LARI
- –°–æ–¥–∂—É: FUNJU

–ó–∞–≤–∂–¥–∏ –ø–∞–º'—è—Ç–∞–π: —Ç–∏ –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π HR-–ø–æ–º—ñ—á–Ω–∏–∫ –¥–ª—è –∫–æ–º–∞–Ω–¥–∏ TD AV, –∞ –Ω–µ –∑–æ–≤–Ω—ñ—à–Ω—ñ–π –º–∞—Ä–∫–µ—Ç–∏–Ω–≥-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç.
"""
```

**Remove or comment out any old marketing personality like:**
```python
# OLD - DELETE THIS
GRADUSMEDIA_PERSONALITY = """
–¢–∏ ‚Äî –ú–∞–π—è, –º–∞—Ä–∫–µ—Ç–∏–Ω–≥-—ç–∫—Å–ø–µ—Ä—Ç –ø–æ –∞–ª–∫–æ–≥–æ–ª—å–Ω–æ–π —ñ–Ω–¥—É—Å—Ç—Ä—ñ—ó...
"""
```

### Fix 2: Update Message Handlers

**Ensure the main message handler uses HR logic:**
```python
async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Main message handler - HR assistant mode"""
    
    telegram_id = update.effective_user.id
    message_text = update.message.text
    
    # Check if user is verified
    user = await db.fetchrow(
        "SELECT * FROM hr_users WHERE telegram_id = $1 AND is_active = TRUE",
        telegram_id
    )
    
    if not user:
        # Redirect to registration
        await update.message.reply_text(
            "‚ö†Ô∏è –î–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Maya –ø–æ—Ç—Ä—ñ–±–Ω–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è.\n\n"
            "–ù–∞–¥—ñ—à–ª–∏ /start —Ç–∞ –≤–≤–µ–¥–∏ —Å–≤—ñ–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É."
        )
        return
    
    # Process HR query with proper personality
    response = await process_hr_query(
        user=user,
        query=message_text,
        personality=HR_ASSISTANT_PERSONALITY  # Use HR personality
    )
    
    await update.message.reply_text(response)
```

### Fix 3: Update Greeting Messages

**Find and replace all greeting messages:**

**OLD (Marketing):**
```python
"–Ø ‚Äî –ú–∞–π—è, –º–∞—Ä–∫–µ—Ç–∏–Ω–≥-—ç–∫—Å–ø–µ—Ä—Ç –ø–æ –∞–ª–∫–æ–≥–æ–ª—å–Ω–æ–π –∏–Ω–¥—É—Å—Ç—Ä–∏–∏ –≤ Gradus Media"
```

**NEW (HR):**
```python
"–Ø Maya, HR-–∞—Å–∏—Å—Ç–µ–Ω—Ç –¢–æ—Ä–≥–æ–≤–æ–≥–æ –î–æ–º—É –ê–í"
```

**Search for these patterns and replace:**
- "–º–∞—Ä–∫–µ—Ç–∏–Ω–≥-—ç–∫—Å–ø–µ—Ä—Ç"
- "Gradus Media"  
- "–∞–ª–∫–æ–≥–æ–ª—å–Ω–æ–π –∏–Ω–¥—É—Å—Ç—Ä–∏–∏"
- "—Ç—Ä–µ–Ω–¥–∞–º–∏ –∞–ª–∫–æ–≥–æ–ª—å–Ω–æ–≥–æ —Ä—ã–Ω–∫–∞"

**Replace with:**
- "HR-–∞—Å–∏—Å—Ç–µ–Ω—Ç"
- "–¢–æ—Ä–≥–æ–≤–∏–π –î—ñ–º –ê–í" or "TD AV"
- "HR-–ø–∏—Ç–∞–Ω–Ω—è–º–∏"
- "—ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é –ø—Ä–æ –∫–æ–º–ø–∞–Ω—ñ—é"

### Fix 4: Update RAG/Claude API Calls

**If using Claude API for responses, update the system prompt:**
```python
async def get_hr_response(query: str, user_context: dict):
    """Get response from Claude with HR personality"""
    
    messages = [
        {
            "role": "system",
            "content": HR_ASSISTANT_PERSONALITY  # Use HR personality
        },
        {
            "role": "user", 
            "content": f"""
            –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: {user_context['first_name']}
            –ü–æ—Å–∞–¥–∞: {user_context['position']}
            –í—ñ–¥–¥—ñ–ª: {user_context['department']}
            
            –ü–∏—Ç–∞–Ω–Ω—è: {query}
            """
        }
    ]
    
    # Call Claude API with HR context
    response = await claude_client.messages.create(
        model="claude-sonnet-4-20250514",
        messages=messages,
        max_tokens=1000
    )
    
    return response.content[0].text
```

### Fix 5: Remove or Disable Marketing Features

**If there are separate marketing functions, disable them:**
```python
# DISABLED - Old Gradus Media marketing features
# async def marketing_expert_response(...):
#     ...

# DISABLED - Market trend analysis
# async def analyze_market_trends(...):
#     ...
```

## TESTING CHECKLIST

After making changes, test:

1. **Send /start** ‚Üí Should say "HR-–∞—Å–∏—Å—Ç–µ–Ω—Ç –¢–æ—Ä–≥–æ–≤–æ–≥–æ –î–æ–º—É –ê–í"
2. **Ask HR question** ‚Üí Should respond as HR assistant, not marketing expert
3. **Check greeting** ‚Üí No mention of "–º–∞—Ä–∫–µ—Ç–∏–Ω–≥-—ç–∫—Å–ø–µ—Ä—Ç" or "Gradus Media"
4. **Verify persona** ‚Üí All responses should be HR-focused

## DELIVERABLES

1. List all files where marketing personality was found
2. Show the old vs new personality definitions  
3. Confirm all handlers now use HR_ASSISTANT_PERSONALITY
4. Test output showing correct HR responses
5. Document any remaining marketing features (if they should be preserved separately)

## CRITICAL NOTES

- This is URGENT - users are getting wrong bot persona
- DO NOT delete authentication code we just implemented
- DO NOT break phone verification flow
- DO keep admin commands (/admin, /adduser, /logs, etc.)
- The bot should ONLY be an HR assistant now, not a marketing expert

IMPLEMENT ALL FIXES ABOVE AND REPORT WHAT WAS CHANGED.
```

---

## **üîç WHAT THIS WILL DO**

The Replit Agent will:

1. ‚úÖ **Search all files** for old marketing personality references
2. ‚úÖ **Replace with HR personality** throughout the codebase
3. ‚úÖ **Update greeting messages** to say "HR-–∞—Å–∏—Å—Ç–µ–Ω—Ç"
4. ‚úÖ **Fix Claude API calls** to use HR system prompt
5. ‚úÖ **Remove marketing features** that don't belong in HR bot
6. ‚úÖ **Test the changes** and confirm HR personality is active
7. ‚úÖ **Generate report** of what was changed

---

## **üìä EXPECTED RESULT AFTER FIX**

**BEFORE (Current - Wrong):**
```
–ü—Ä–∏–≤–µ—Ç! üëã
–Ø ‚Äî –ú–∞–π—è, –º–∞—Ä–∫–µ—Ç–∏–Ω–≥-—ç–∫—Å–ø–µ—Ä—Ç –ø–æ –∞–ª–∫–æ–≥–æ–ª—å–Ω–æ–π –∏–Ω–¥—É—Å—Ç—Ä–∏–∏ –≤ Gradus Media.
...–≤–æ–ø—Ä–æ—Å—ã –ø–æ –∞–ª–∫–æ–≥–æ–ª—å–Ω–æ–º—É —Ä—ã–Ω–∫—É –∏–ª–∏ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥—É?
```

**AFTER (Correct - HR):**
```
–ü—Ä–∏–≤—ñ—Ç! üëã
–Ø Maya, HR-–∞—Å–∏—Å—Ç–µ–Ω—Ç –¢–æ—Ä–≥–æ–≤–æ–≥–æ –î–æ–º—É –ê–í.
...–ø–∏—Ç–∞–Ω–Ω—è –ø—Ä–æ —Ä–æ–±–æ—Ç—É, –≤—ñ–¥–ø—É—Å—Ç–∫–∏, –∞–±–æ –∫–æ–º–ø–∞–Ω—ñ—é?