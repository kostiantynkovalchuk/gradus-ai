# Implement Phone Number Handling for Authenticated Users

## PROBLEM
When authenticated users send phone numbers, Maya treats them as HR questions instead of detecting they're already verified.

Example from logs:
```
User (authenticated): +80503343534
System: Routes to HR RAG ‚ùå
Maya: "Not found in knowledge base" (confusing!)
```

## SOLUTION
Add phone number detection BEFORE routing to HR RAG service.

## IMPLEMENTATION

In `backend/routes/telegram_webhook.py`, find the authenticated user message handler and add phone detection:
```python
# Find this section (around where authenticated users are handled):

# USER IS AUTHENTICATED
user_data = await get_user_by_telegram_id(db, telegram_id)

if user_data and user_data.get('is_active'):
    # Authenticated user
    
    # CHECK IF THEY SENT A PHONE NUMBER (add this!)
    if is_phone_number(message_text):
        logger.info(
            f"üì± AUTH_USER_PHONE: telegram_id={telegram_id}, "
            f"current_user={user_data['full_name']}, "
            f"phone_sent={message_text[:4]}***"
        )
        
        keyboard = [
            [InlineKeyboardButton(
                text="üîÑ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ü–µ–π –Ω–æ–º–µ—Ä",
                callback_data="hr_reverify:confirm"
            )],
            [InlineKeyboardButton(
                text="üìã HR –º–µ–Ω—é",
                callback_data="hr_menu:main"
            )]
        ]
        
        # Store phone for reverification
        context.user_data['reverify_phone'] = message_text
        
        await update.message.reply_text(
            f"‚úÖ –í–∏ –≤–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ñ —è–∫ *{user_data['full_name']}*\n\n"
            f"üì± –í–∏ –Ω–∞–¥—ñ—Å–ª–∞–ª–∏ –Ω–æ–º–µ—Ä: `{message_text}`\n\n"
            f"–©–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –∑—Ä–æ–±–∏—Ç–∏?",
            reply_markup=InlineKeyboardMarkup(keyboard),
            parse_mode='Markdown'
        )
        
        return  # Don't route to HR RAG!
    
    # Not a phone - route to HR RAG service
    logger.info(f"üìã Routing to HR service: {message_text[:50]}")
    # ... existing HR RAG logic ...
```

Add the reverification callback handler:
```python
# In callback handler, add this case:
if callback_data == "hr_reverify:confirm":
    phone = context.user_data.get('reverify_phone')
    
    if not phone:
        await query.answer("–°–µ—Å—ñ—è –∑–∞—Å—Ç–∞—Ä—ñ–ª–∞. –ù–∞–¥—ñ—à–ª—ñ—Ç—å –Ω–æ–º–µ—Ä —â–µ —Ä–∞–∑.", show_alert=True)
        return
    
    # Get current user
    current_user = await get_user_by_telegram_id(db, telegram_id)
    
    await query.message.edit_text(
        f"üîç –ü–µ—Ä–µ–≤—ñ—Ä—è—é –Ω–æ–º–µ—Ä {phone}..."
    )
    
    # Verify with SED
    from services.hr_sed_service import verify_employee_in_sed
    
    employee = await verify_employee_in_sed(phone)
    
    if employee:
        # Update account
        await save_verified_user(telegram_id, employee)
        
        await query.message.edit_text(
            f"‚úÖ –û–Ω–æ–≤–ª–µ–Ω–æ!\n\n"
            f"–¢–µ–ø–µ—Ä –≤–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ñ —è–∫:\n"
            f"‚Ä¢ {employee['full_name']}\n"
            f"‚Ä¢ {employee.get('position', 'N/A')}",
            reply_markup=get_hr_main_menu_keyboard()
        )
    else:
        await query.message.edit_text(
            f"‚ùå –ù–æ–º–µ—Ä –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.\n\n"
            f"–í–∏ –∑–∞–ª–∏—à–∞—î—Ç–µ—Å—å —è–∫ {current_user['full_name']}.",
            reply_markup=get_hr_main_menu_keyboard()
        )
    
    # Clear stored phone
    context.user_data.pop('reverify_phone', None)
```